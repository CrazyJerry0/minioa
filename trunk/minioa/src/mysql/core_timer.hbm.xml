<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC 
      "-//Hibernate/Hibernate Mapping DTD 3.0//EN" 
      "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping auto-import="true" package="org.minioa.core">
    <sql-query name="core.task.select.records.duation">
    <![CDATA[
				select task.ID_,process.CID_,u.userName,taskDef.taskApproveType,taskDef.taskApprover,process.processDesc
				from core_task task
				left join core_processdefinition_task taskdef on taskDef.ID_ = task.taskDefId
				left join core_process process on process.ID_ = task.processId
				left join core_user u on u.ID_ = process.CID_
				where task.taskStatus='running' and date_add(task.startDate,interval taskdef.taskDuation day) < sysdate()
					and (task.MDATE_ is null or date_add(task.MDATE_,interval 1 day) < sysdate());
    ]]>
    </sql-query>
    <sql-query name="core.task.update.mdate.duation">
    <![CDATA[
				update core_task set MDATE_ = sysdate() where ID_ = :id
    ]]>
    </sql-query>
    <sql-query name="core.role.users">
    <![CDATA[
    	SELECT u.userName FROM core_role_user_relation rr
			left join core_role role on role.ID_ = rr.roleId
			left join core_user u on u.ID_ = rr.userId
			where role.roleName = :roleName
			order by u.userName
    ]]>
    </sql-query>
    <sql-query name="core.user.select.email.where.username">
    <![CDATA[
        select email from core_user where userName = :userName and email!='' and email is not null
    ]]>
    </sql-query>
    <sql-query name="core.user.select.username.where.id">
    <![CDATA[
        select userName from core_user where ID_ = :id
    ]]>
    </sql-query>
		<sql-query name="core.user.select.superior.where.id">
    <![CDATA[
        select u2.userName
        from core_user u
        left join core_user u2 on u2.ID_ = u.superiorId
        where u.ID_ = :id
    ]]>
    </sql-query>
		<sql-query name="core.user.select.manager.where.id">
    <![CDATA[
        select u3.userName
        from core_user u
        left join core_user u3 on u3.ID_ = u.managerId
        where u.ID_ = :id
    ]]>
    </sql-query>
</hibernate-mapping>