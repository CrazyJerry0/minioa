<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC 
      "-//Hibernate/Hibernate Mapping DTD 3.0//EN" 
      "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping auto-import="true" package="org.minioa.core">
    <sql-query name="core.news.insert.record">
    <![CDATA[
        insert into core_news(CID_,CDATE_,cateCode,title,content,isPicNews,isApproved,uuid) values(:cId,:cDate,:cateCode,:title,:content,:isPicNews,false,:uuid)
    ]]>
    </sql-query>
    <sql-query name="core.news.select.records">
    <![CDATA[
        select n.ID_,n.CID_,n.CDATE_,
        	n.cateCode,n.title,'',n.isPicNews,n.isApproved,n.uuid,u.displayName,b.value2,pro.processStatus
        from core_news n
        left join core_user u on u.ID_ = n.CID_
        left join core_basicdata b on b.value= n.cateCode and b.name='新闻分类'
        left join core_process pro on pro.instanceId = n.ID_ and pro.tableName='core_news' 
    ]]>
    </sql-query>
    <sql-query name="core.news.select.records.shortList">
    <![CDATA[
        select n.ID_,n.CDATE_,n.title
        from core_news n where n.isApproved = 1 and n.cateCode = :cateCode order by n.CDATE_ desc limit 10
    ]]>
    </sql-query>
    <sql-query name="core.news.select.records.picnews">
    <![CDATA[
        select n.ID_,n.title,(select t.fileName from core_news_attachment t where LOWER(t.fileType) in ('.jpeg','.jpg','.gif','.bpm','.png') and t.uuid = n.uuid order by t.ID_ limit 1)
        from core_news n
        where n.isPicNews=1 and n.isApproved=1
				order by n.CDATE_ desc
				limit 5
    ]]>
    </sql-query>
    <sql-query name="core.news.select.records.count">
    <![CDATA[
        select count(*) as result from core_news
    ]]>
    </sql-query>
    <sql-query name="core.news.select.record.where.id">
    <![CDATA[
        select n.ID_,n.CID_,n.CDATE_,
        	n.cateCode,n.title,n.content,n.isPicNews,n.isApproved,n.uuid,u.displayName,b.value2
        from core_news n
        left join core_user u on u.ID_ = n.CID_
        left join core_basicdata b on b.value= n.cateCode and b.name='新闻分类'
        where n.ID_ = :id
    ]]>
    </sql-query>
    <sql-query name="core.news.update.record.where.id">
    <![CDATA[
        update core_news set MID_ = :mId, MDATE_ = :mDate,
        	cateCode = :cateCode, title = :title, content = :content, isPicNews=:isPicNews
        where ID_ = :id
    ]]>
    </sql-query>
    <sql-query name="core.news.update.approve.where.id">
    <![CDATA[
        update core_news set MID_ = :mId, MDATE_ = :mDate,
        	isApproved = !isApproved
        where ID_ = :id
    ]]>
    </sql-query>
    <sql-query name="core.news.delete.record.where.id">
    <![CDATA[
        delete from core_news where ID_ = :id
    ]]>
    </sql-query>
</hibernate-mapping>